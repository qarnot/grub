#!/bin/sh
set -e
grub-mkconfig -o /boot/efi/grub.cfg "$@"

# sign config
GPG_KEY=/root/setup-scripts/gpg-key

sign(){
	if [ -f $GPG_KEY ]; then
		rm -rf "$1".sig
		gpg --default-key "$(cat $GPG_KEY)" --detach-sign "$1"
		echo "Signing $1..."
	else
		echo "Not GPG key, not signing $1..."
	fi
}

sign /boot/efi/grub.cfg
